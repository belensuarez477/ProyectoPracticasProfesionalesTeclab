<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Dashboard - Mi Perfil</h1>
    <div class="user-info" *ngIf="currentUser">
      <span>{{ currentUser.nombre }} {{ currentUser.apellido }}</span>
      <button class="logout-btn" (click)="logout()">Cerrar Sesi√≥n</button>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="tabs-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'profile'"
      (click)="setTab('profile')">
      üë§ Mi Perfil
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'appointments'"
      (click)="setTab('appointments')">
      üìÖ Mis Turnos
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'services'"
      (click)="setTab('services')">
      üíá Mis Servicios
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tabs-content">

    <!-- PERFIL TAB -->
    <div *ngIf="activeTab === 'profile'" class="tab-panel">
      <h2>Mi Perfil</h2>
      <div class="profile-info" *ngIf="currentUser">
        <div class="info-group">
          <label>Nombre:</label>
          <p>{{ currentUser.nombre }} {{ currentUser.apellido }}</p>
        </div>
        <div class="info-group">
          <label>Email:</label>
          <p>{{ currentUser.email }}</p>
        </div>
        <div class="info-group">
          <label>Tel√©fono:</label>
          <p>{{ currentUser.telefono || 'No especificado' }}</p>
        </div>
        <div class="info-group">
          <label>Tipo de Usuario:</label>
          <p>{{ currentUser.tipoUsuario === 'profesional' ? 'Profesional' : 'Cliente' }}</p>
        </div>
      </div>
    </div>

    <!-- TURNOS TAB -->
    <div *ngIf="activeTab === 'appointments'" class="tab-panel">
      <h2>Agendar Turno</h2>
      <form class="form-section">
        <div class="form-group">
          <label>Fecha del Turno</label>
          <input 
            type="date" 
            [(ngModel)]="newAppointment.date"
            name="date"
          />
        </div>
        <div class="form-group">
          <label>Hora</label>
          <input 
            type="time" 
            [(ngModel)]="newAppointment.time"
            name="time"
          />
        </div>
        <div class="form-group">
          <label>Nombre del Cliente</label>
          <input 
            type="text" 
            placeholder="Nombre completo"
            [(ngModel)]="newAppointment.clientName"
            name="clientName"
          />
        </div>
        <div class="form-group">
          <label>Servicio</label>
          <select [(ngModel)]="newAppointment.serviceId" name="serviceId">
            <option value="">Selecciona un servicio</option>
            <option *ngFor="let service of services" [value]="service.servicioId || service.id">
              {{ service.nombre }}
            </option>
          </select>
        </div>
        <button type="button" class="submit-btn" (click)="addAppointment()">Agendar Turno</button>
      </form>

      <h3>Mis Turnos Agendados</h3>
      <div class="appointments-list">
        <div *ngIf="appointments.length === 0" class="empty-message">
          No hay turnos agendados
        </div>
        <div *ngFor="let appointment of appointments" class="appointment-card">
          <div class="appointment-info">
            <p><strong>Cliente:</strong> {{ appointment.clientName }}</p>
            <p><strong>Servicio:</strong> {{ appointment.service }}</p>
            <p><strong>Fecha:</strong> {{ appointment.date }}</p>
            <p><strong>Hora:</strong> {{ appointment.time }}</p>
          </div>
          <button class="delete-btn" (click)="deleteAppointment(appointment.id)">Eliminar</button>
        </div>
      </div>
    </div>

    <!-- SERVICIOS TAB -->
    <div *ngIf="activeTab === 'services'" class="tab-panel">
      <h2>Mis Servicios</h2>
      <form class="form-section">
        <div class="form-group">
          <label>Nombre del Servicio *</label>
          <input 
            type="text" 
            placeholder="Ej: Corte de cabello"
            [(ngModel)]="newService.nombre"
            name="nombre"
            required
          />
        </div>
        <div class="form-group">
          <label>Descripci√≥n</label>
          <textarea 
            placeholder="Descripci√≥n del servicio"
            [(ngModel)]="newService.descripcion"
            name="descripcion"
            rows="3"
          ></textarea>
        </div>
        <div class="form-group">
          <label>Duraci√≥n (minutos) *</label>
          <input 
            type="number" 
            [(ngModel)]="newService.duracion"
            name="duracion"
            min="15"
            step="15"
            required
          />
        </div>
        <div class="form-group">
          <label>Precio ($) *</label>
          <input 
            type="number" 
            [(ngModel)]="newService.precio"
            name="precio"
            min="0"
            step="0.01"
            required
          />
        </div>
        <button type="button" class="submit-btn" (click)="addService()" [disabled]="isSavingService">
          {{ isSavingService ? 'Guardando...' : 'Crear Servicio' }}
        </button>
      </form>

      <h3>Servicios Disponibles</h3>
      <div class="services-list">
        <div *ngIf="servicesError" class="empty-message">
          {{ servicesError }}
        </div>
        <div *ngIf="isLoadingServices" class="empty-message">
          Cargando servicios...
        </div>
        <div *ngIf="!isLoadingServices && services.length === 0" class="empty-message">
          No hay servicios registrados en Firebase
        </div>
        <div *ngFor="let service of services" class="service-card">
          <div class="service-info">
            <p><strong>{{ service.nombre }}</strong></p>
            <p *ngIf="service.descripcion">{{ service.descripcion }}</p>
            <p>Duraci√≥n: {{ service.duracion }} minutos</p>
            <p>Precio: ${{ service.precio }}</p>
          </div>
          <div class="service-actions">
            <button class="view-btn" (click)="viewServiceDetails(service)">Ver Detalles</button>
            <button class="delete-btn" (click)="deleteService(service.servicioId || service.id)">Eliminar</button>
          </div>
        </div>
      </div>

      <!-- Modal de Detalles del Servicio -->
      <div *ngIf="selectedService" class="modal-overlay" (click)="closeServiceDetails()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ selectedService.nombre }}</h2>
            <button class="close-btn" (click)="closeServiceDetails()">‚úï</button>
          </div>

          <div class="modal-body">
            <div class="service-details">
              <p><strong>Descripci√≥n:</strong> {{ selectedService.descripcion || 'Sin descripci√≥n' }}</p>
              <p><strong>Duraci√≥n:</strong> {{ selectedService.duracion }} minutos</p>
              <p><strong>Precio:</strong> ${{ selectedService.precio }}</p>
            </div>

            <hr>

            <h3>Configurar Horarios</h3>
            <div class="schedule-form">
              <div class="form-row">
                <div class="form-group">
                  <label>D√≠a de la semana</label>
                  <select [(ngModel)]="newSchedule.dia" name="dia">
                    <option *ngFor="let day of daysOfWeek" [value]="day">{{ day | titlecase }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Hora Inicio</label>
                  <input type="time" [(ngModel)]="newSchedule.horaInicio" name="horaInicio">
                </div>
                <div class="form-group">
                  <label>Hora Fin</label>
                  <input type="time" [(ngModel)]="newSchedule.horaFin" name="horaFin">
                </div>
              </div>
              <button type="button" class="submit-btn" (click)="addScheduleToService()">
                Agregar Horario
              </button>
            </div>

            <hr>

            <h3>Horarios Configurados</h3>
            <div class="schedules-list">
              <div *ngIf="!selectedService.horarios || selectedService.horarios.length === 0" class="empty-message">
                No hay horarios configurados
              </div>
              <div *ngFor="let horario of selectedService.horarios" class="schedule-item">
                <strong>{{ horario.dia | titlecase }}:</strong> 
                {{ horario.horaInicio }} - {{ horario.horaFin }}
                <span *ngIf="!horario.disponible" style="color: red;"> (No disponible)</span>
              </div>
            </div>

            <hr>

            <h3>Turnos Agendados</h3>
            <div class="day-tabs">
              <button 
                *ngFor="let day of daysOfWeek" 
                class="day-tab"
                [class.active]="getAppointmentsByDay(day).length > 0"
                (click)="selectedDay = day">
                {{ day | titlecase }} ({{ getAppointmentsByDay(day).length }})
              </button>
            </div>

            <div class="appointments-by-day">
              <div *ngIf="serviceAppointments.length === 0" class="empty-message">
                No hay turnos agendados para este servicio
              </div>
              <div *ngFor="let apt of serviceAppointments" class="appointment-item">
                <div class="appointment-header">
                  <h4>{{ apt.clienteNombre }}</h4>
                  <span class="status-badge" [class]="'status-' + apt.estadoAsistencia">{{ apt.estadoAsistencia }}</span>
                </div>
                <div class="appointment-details">
                  <div class="detail-row">
                    <span class="icon">üìÖ</span>
                    <strong>Fecha:</strong> {{ apt.fecha | date:'EEEE, dd/MM/yyyy':'':'es' }}
                  </div>
                  <div class="detail-row">
                    <span class="icon">‚è∞</span>
                    <strong>Hora:</strong> {{ apt.hora }}
                  </div>
                  <div class="detail-row">
                    <span class="icon">‚åõ</span>
                    <strong>Duraci√≥n:</strong> {{ apt.duracion }} minutos
                  </div>
                  <div class="detail-row">
                    <span class="icon">‚úÖ</span>
                    <strong>Asistencia:</strong> {{ apt.estadoAsistencia }}
                  </div>
                  <div class="detail-row">
                    <span class="icon">üíµ</span>
                    <strong>Precio:</strong> ${{ apt.precio }}
                  </div>
                  <div class="detail-row">
                    <span class="icon">üõ†Ô∏è</span>
                    <strong>Actualizar:</strong>
                    <select [ngModel]="apt.estadoAsistencia" (ngModelChange)="updateAttendance(apt, $event)">
                      <option value="presente">Presente</option>
                      <option value="ausente">Ausente</option>
                      <option value="cancelado">Cancelado</option>
                      <option value="reprogramado">Reprogramado</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
